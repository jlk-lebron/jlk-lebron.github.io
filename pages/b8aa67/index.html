<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>组件 | 小王的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="logo.png">
    <meta name="description" content="小王的博客">
    
    <link rel="preload" href="/assets/css/0.styles.cc68c345.css" as="style"><link rel="preload" href="/assets/js/app.8d6e8c80.js" as="script"><link rel="preload" href="/assets/js/2.d1a10b95.js" as="script"><link rel="preload" href="/assets/js/32.9f59f731.js" as="script"><link rel="prefetch" href="/assets/js/10.078876b2.js"><link rel="prefetch" href="/assets/js/11.0d348b04.js"><link rel="prefetch" href="/assets/js/12.674ecd59.js"><link rel="prefetch" href="/assets/js/13.2cdcfa0f.js"><link rel="prefetch" href="/assets/js/14.7578ba3e.js"><link rel="prefetch" href="/assets/js/15.ed069ce5.js"><link rel="prefetch" href="/assets/js/16.0476bc39.js"><link rel="prefetch" href="/assets/js/17.ffbcbdbd.js"><link rel="prefetch" href="/assets/js/18.564accfd.js"><link rel="prefetch" href="/assets/js/19.0909a6e8.js"><link rel="prefetch" href="/assets/js/20.597bd687.js"><link rel="prefetch" href="/assets/js/21.b7b22c7e.js"><link rel="prefetch" href="/assets/js/22.e3bb53df.js"><link rel="prefetch" href="/assets/js/23.4040088c.js"><link rel="prefetch" href="/assets/js/24.888c00f7.js"><link rel="prefetch" href="/assets/js/25.bae0a4d4.js"><link rel="prefetch" href="/assets/js/26.b4839473.js"><link rel="prefetch" href="/assets/js/27.4c4ac2c9.js"><link rel="prefetch" href="/assets/js/28.6c49ccc3.js"><link rel="prefetch" href="/assets/js/29.51c04b02.js"><link rel="prefetch" href="/assets/js/3.59105492.js"><link rel="prefetch" href="/assets/js/30.61b3e3f7.js"><link rel="prefetch" href="/assets/js/31.e6c5d0ac.js"><link rel="prefetch" href="/assets/js/33.c57a674a.js"><link rel="prefetch" href="/assets/js/34.7b1d074b.js"><link rel="prefetch" href="/assets/js/35.41092fee.js"><link rel="prefetch" href="/assets/js/36.579a58ab.js"><link rel="prefetch" href="/assets/js/37.bb015b50.js"><link rel="prefetch" href="/assets/js/38.dd4347c1.js"><link rel="prefetch" href="/assets/js/39.682bbcb3.js"><link rel="prefetch" href="/assets/js/4.dcab0898.js"><link rel="prefetch" href="/assets/js/40.07e67951.js"><link rel="prefetch" href="/assets/js/41.653b5e32.js"><link rel="prefetch" href="/assets/js/42.cffbb347.js"><link rel="prefetch" href="/assets/js/43.688a94c9.js"><link rel="prefetch" href="/assets/js/44.42a52d40.js"><link rel="prefetch" href="/assets/js/45.5efaf9e2.js"><link rel="prefetch" href="/assets/js/46.fc11a50f.js"><link rel="prefetch" href="/assets/js/47.c54685cf.js"><link rel="prefetch" href="/assets/js/48.01b4bfa6.js"><link rel="prefetch" href="/assets/js/49.5341fdc9.js"><link rel="prefetch" href="/assets/js/5.9e5cbc4b.js"><link rel="prefetch" href="/assets/js/50.867d8e1a.js"><link rel="prefetch" href="/assets/js/51.7c7c986d.js"><link rel="prefetch" href="/assets/js/52.2e397db2.js"><link rel="prefetch" href="/assets/js/53.5790beaf.js"><link rel="prefetch" href="/assets/js/54.9d4c626a.js"><link rel="prefetch" href="/assets/js/55.19763e86.js"><link rel="prefetch" href="/assets/js/56.dd197ef7.js"><link rel="prefetch" href="/assets/js/57.667b5e2b.js"><link rel="prefetch" href="/assets/js/58.971bd997.js"><link rel="prefetch" href="/assets/js/59.1a5b48bb.js"><link rel="prefetch" href="/assets/js/6.28415204.js"><link rel="prefetch" href="/assets/js/60.e4ee51c1.js"><link rel="prefetch" href="/assets/js/61.c044fdf2.js"><link rel="prefetch" href="/assets/js/62.c6cf56f4.js"><link rel="prefetch" href="/assets/js/63.a381078e.js"><link rel="prefetch" href="/assets/js/64.76f59cd9.js"><link rel="prefetch" href="/assets/js/7.aa2959d8.js"><link rel="prefetch" href="/assets/js/8.55b74a1e.js"><link rel="prefetch" href="/assets/js/9.1809c38a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cc68c345.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小王的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/index.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><!----> <span class="title" style="display:;">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jlk-lebron/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1849806240878344" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.staticaly.com/gh/jlk-lebron/blog-img@main/PicGo/zms.jpg"> <div class="blogger-info"><h3>Lebron Jia</h3> <span>前端小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/docs/index.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><!----> <span class="title" style="display:;">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jlk-lebron/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1849806240878344" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/5ba336/" class="sidebar-link">初体验</a></li><li><a href="/pages/afcf45/" class="sidebar-link">Vue3通信方式</a></li><li><a href="/pages/aa6377/" class="sidebar-link">Vue常见指令</a></li><li><a href="/pages/34bcc6/" class="sidebar-link">Vue3 组合式API</a></li><li><a href="/pages/4b8ce7/" class="sidebar-link">Pinia</a></li><li><a href="/pages/daca29/" class="sidebar-link">跨域问题</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Important</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=React" title="分类" data-v-06225672>React</a></li><li data-v-06225672><a href="/categories/?category=%E5%9F%BA%E7%A1%80" title="分类" data-v-06225672>基础</a></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-08-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">组件<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="组件介绍及基本使用"><a href="#组件介绍及基本使用" class="header-anchor">#</a> 组件介绍及基本使用</h1> <blockquote><p>一个 React 应用就是由一个个的组件组成的</p></blockquote> <p>组件是 react 中非常重要的一个特性.利用组件可以将 UI(页面结构) 拆分为独立可复用的代码片段，并对每个片段进行独立构思。</p> <h2 id="为什么要使用组件"><a href="#为什么要使用组件" class="header-anchor">#</a> 为什么要使用组件</h2> <p>当我们写网页时,会发现网页中出现大量相同的结构, 传统的处理方式是将重复的标签再写一次. 如下图所示每一个商品的展示都是由多个标签组成.页面中会出现大量相同结构的标签.这样的代码维护起来非常困难.</p> <p>如果可以将这个相同结构的标签封装起来,就好像 js 中将相同的代码封装到函数里面,这样的代码维护性就会非常高.</p> <p>还有, 轮播图是网页中常见效果,几乎每一个项目都要写. 轮播图中不仅有复杂的 html 结构,也有复杂的 js 逻辑. 如果把轮播图的 js 代码和其他功能的 js 代码写在一起,未来修改代码时,极容易 <code>动一发牵全身</code>.如果可以将轮播的结构和 js 封装到一个文件中,这样不仅在写的时候方便查找元素,而且未来维护时也可以快速找到对应的文件进行修改,提高了编程效率</p> <p>而且如果整个页面将所有结构都进行封装,也可以大大提高代码的解耦程度</p> <h2 id="创建一个组件并使用"><a href="#创建一个组件并使用" class="header-anchor">#</a> 创建一个组件并使用</h2> <p><strong>react 中分为两类组件:</strong></p> <ol><li>函数组件</li> <li>类组件</li></ol> <h3 id="创建函数组件"><a href="#创建函数组件" class="header-anchor">#</a> 创建函数组件</h3> <blockquote><p>创建函数组件的规则:</p></blockquote> <div class="language- extra-class"><pre><code>1. 组件名(函数名) 首字母大写

2. 必须写 return, return 后面写 jsx, 如果无需渲染结构,则 return null
</code></pre></div><div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>这是一个函数组件<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="创建类组件"><a href="#创建类组件" class="header-anchor">#</a> 创建类组件</h3> <blockquote><p>创建类组件的规则:</p></blockquote> <div class="language- extra-class"><pre><code>1. 组件名(类名)首字母大写

2. 必须继承 React.Component 组件

3. 类结构体中必须定义 render 函数

4. render 函数中必须 return, return 后面可以写 jsx 或 null
</code></pre></div><div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>这是一个类组件<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用组件"><a href="#使用组件" class="header-anchor">#</a> 使用组件</h3> <blockquote><p>类组件和函数组件使用的方式是一样的</p></blockquote> <div class="language- extra-class"><pre><code>1. 组件使用既可以写成双标签也可以写成单标签

2. 使用组件,相当于就是实例化组件

3. 组件使用写在哪里, 组件的结构就渲染在哪里
</code></pre></div><div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span>

<span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>这是一个函数组件<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token comment">/*使用Item组件*/</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token comment">/* Item组件中的li标签就会渲染到当前位置*/</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>Item<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Item<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token comment">/*使用Item组件另一种写法*/</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>Item <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
</code></pre></div><p><strong>如图所示: Item 组件使用了两次,则渲染出来两个 li 标签, Item 组件写在 <code>&lt;hr /&gt;</code> 标签之间, 则组件的结构就渲染在 <code>&lt;hr /&gt;</code> 标签之间</strong></p> <h2 id="react-项目中使用组件的规范"><a href="#react-项目中使用组件的规范" class="header-anchor">#</a> react 项目中使用组件的规范:</h2> <ol><li>一个组件应该单独定义在一个.js/.jsx 文件中(这两种类型的文件本质没有区别,只是后缀名不同)</li> <li>一个 react 项目,应该在项目根目录定义一个名为 <code>App.js</code>或 <code>App.jsx</code>的根组件.</li> <li>入口文件中引入并使用根组件,其他组件在根组件中使用</li></ol> <h2 id="关于组件名首字母大写问题"><a href="#关于组件名首字母大写问题" class="header-anchor">#</a> 关于组件名首字母大写问题</h2> <p>有时我们会发现,定义组件的时候没有写组件名或组件名首字母没有大写,代码也可以正常运行. 那是因为 react 解析 jsx 时,通过首字母是否大写作为判断我们写在 jsx 中的标签是组件还是普通标签.所以只要在使用组件的时候保证组件首字母大写即可.不过实际开发依然建议定义组件时首字母大写.</p> <p>例如:</p> <div class="language-Plain extra-class"><pre class="language-plain"><code>// App.js
export default class app extends React.Component {
  render() {
    return &lt;div&gt;{this.state.count}&lt;/div&gt;
  }
}
</code></pre></div><div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.js'</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="类组件的状态"><a href="#类组件的状态" class="header-anchor">#</a> 类组件的状态</h1> <blockquote><p>状态（state）即组件的私有数据. 函数组件默认没有状态, 类组件有自己的状态，负责更新 UI，让页面“动” 起来</p></blockquote> <p><strong>应用场景:</strong></p> <p>购物车界面中增减商品数量的结构很多地方都要用,一般会封装成组件.当用户对某个商品进行增/减操作时,其他商品的数量不应该受到影响,并且页面要展示增/减之后的最新数量.这样的需求用状态来实现是最合适不过的.</p> <p><img src="import/images/edit2.png" alt=""></p> <h2 id="状态的定义-使用和修改"><a href="#状态的定义-使用和修改" class="header-anchor">#</a> 状态的定义,使用和修改</h2> <ul><li><p>定义和使用状态</p> <div class="language-Plain extra-class"><pre class="language-plain"><code>class Hello extends React.Component {
  constructor() {
    super()
    // constructor和render函数中的this是当前Hello组件实例对象
    this.state = { count: 0 } // 定义state
  }
  render() {
    // 使用状态(状态总是与页面渲染有关)
    return &lt;div&gt;{this.state.count}&lt;/div&gt;
  }
}
</code></pre></div></li> <li><p>修改状态</p> <blockquote><p>修改状态应该使用 <code>this.setState({目标属性: 目标值})</code></p></blockquote> <div class="language-Plain extra-class"><pre class="language-plain"><code>class Hello extends React.Component {
  constructor() {
    super()
    this.state = { count: 0 } // 定义state
  }
  render() {
    return &lt;div&gt;
              {this.state.count}
              {/* 点击按钮,修改状态的值 */}
              &lt;button
                onClick={()=&gt;{
                  // 一定要通过this.setState进行修改
                  this.setState({
                    count: this.state.count + 1
                  })}
                  // 不要直接修改,直接修改无法导致组件更新,页面也就无法展示最新数据
                  // this.state.count = this.state.count + 1 错误的方式
              &gt;按钮&lt;/button&gt;
          &lt;/div&gt;
    }
  }
</code></pre></div></li></ul> <p>作用: 1. 修改状态的值 2.让组件更新,从而导致页面展示最新数据</p> <h2 id="setstate-的注意点"><a href="#setstate-的注意点" class="header-anchor">#</a> setState 的注意点</h2> <p><strong>setState 更新是异步的</strong></p> <div class="language- extra-class"><pre><code>-`setState()` enqueues changes to the component state and tells React that this component and its children need to be re-rendered with the updated state (`setState()` 将对组件 state 的更改排入队列，并通知 React 需要使用更新后的 state 重新渲染此组件及其子组件)
</code></pre></div><p>这句话是从 React 官网中摘抄下来的. setState 对数据的更改是放入队列中等待执行的. 所以 setState 之后,立刻获取数据一定是之前的数据</p> <div class="language-Plain extra-class"><pre class="language-plain"><code>import React, { Component } from 'react'
export default class Hello extends Component {
  constructor(){
	this.state = {count: 0}
  }
  render() {
    return (
        &lt;button
          onClick={()=&gt;{
        		this.setState({
                    count: this.state.count + 1
				})
        		console.log(this.state.count) // 结果为0
		  }&gt;
         按钮
        &lt;/button&gt;
      &lt;/li&gt;
    )
  }
}
</code></pre></div><h2 id="setstate-的其他特性-了解-不常用"><a href="#setstate-的其他特性-了解-不常用" class="header-anchor">#</a> setState 的其他特性(了解,不常用)</h2> <ul><li><p>setState 更新会合并</p> <blockquote><p><code>setState()</code> does not always immediately update the component. It may batch or defer the update until later(<code>setState()</code> 并不总是立即更新组件。它会批量推迟更新)</p></blockquote> <div class="language-Plain extra-class"><pre class="language-plain"><code>import React, { Component } from 'react'
export default class Test extends Component {
  constructor(){
	  this.state = {count: 0, msg: 'hello'}
  }
  render() {
    return (
        &lt;button
          onClick={()=&gt;{
        		this.setState({
                  count: this.state.count + 1,
                  msg: 'halo'
				})
        		this.setState({
                  count: this.state.count + 2
				})
        		this.setState({
                  count: this.state.count + 3
				})
        		// 上面的三次连续调用,会合并成一次. 合并之后的结果,类似于下面的代码
        		this.setState({
                  count: this.state.count + 3
                  msg: 'halo'
				})}&gt;
         按钮
        &lt;/button&gt;
      &lt;/li&gt;
    )
  }
}
</code></pre></div></li></ul> <p>这句话也是从 React 官网摘抄下来的,很显然,如果 setState 调用之后,立刻渲染.效率一定是低下的.因为可能会出现 setState 连续调用的情况</p> <ul><li><p>setState 第一个参数,可以写成回调函数</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">//如果当前setState是第一个调用的,则回调立刻执行. 如果之前调用过setState,这次setState的回调等待之前数据修改完毕之后执行</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//state是最新的state数据</span>
  <span class="token comment">//props是组件外传进来的数据</span>
  <span class="token keyword">return</span> 目标值
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>setState 第二个参数也是回调函数</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// setState的第二个参数是一个回调函数,是一个可选参数. 它将在 setState 完成合并并重新渲染组件后执行</span>
<span class="token function">setState</span><span class="token punctuation">(</span>第一个参数<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <hr> <h1 id="类组件中函数的-this-问题"><a href="#类组件中函数的-this-问题" class="header-anchor">#</a> 类组件中函数的 this 问题</h1> <blockquote><p>函数组件中没有 this,所以这里主要讨论类组件中的 this. 在类组件中 constructor 和 render 的 this 一定指向组件实例,这是确定的. 所以下面讨论的 this,主要是组件中事件处理函数的 this 问题</p></blockquote> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> isEdit<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token operator">!</span>isEdit <span class="token operator">?</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>label<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>span <span class="token operator">&gt;</span>学习javascript<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">isEdit</span><span class="token operator">:</span> <span class="token operator">!</span>isEdit<span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token comment">/* 通过判断isEdit的值,控制按钮文本 */</span><span class="token punctuation">}</span>
          <span class="token punctuation">{</span><span class="token operator">!</span>isEdit <span class="token operator">?</span> <span class="token string">'编辑'</span> <span class="token operator">:</span> <span class="token string">'取消'</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>通过上面的代码,我们可以看到,render 函数中本来就有大量的 JSX 结构, 一般事件处理函数中也可能出现大量复杂的代码,为了提高代码的可读性. 一般我们并不会在 JSX 中直接定义事件处理函数. 更好的处理方式是把事件处理函数定义在 JSX 结构外面.</p> <p>实际开发中,大部分开发者中会选择,将事件处理函数通过类的语法定义在类的原型上.如下面代码所示:</p> <div class="language-Plain extra-class"><pre class="language-plain"><code>import React, { Component } from 'react'
export default class Test extends Component {
  // 按照es6类的语法,把函数写在这里,就是把函数定义在了当前类的原型上
  handle(){}

  render() {
    return (
        &lt;button
          onClick={this.handle}&gt;
         按钮
        &lt;/button&gt;
      &lt;/li&gt;
    )
  }
}
</code></pre></div><p>把事件处理函数定义在类的原型上,无疑是非常好的选择,因为当前类的所有实例,都可以访问这个函数. 而且这个函数只在原型上创建了一次,性能也更好.但是这样写也有问题. 就是无法再通过 this 访问到当前组件实例了</p> <p>接下来,主要讨论一下,如何让 handle 函数中的 this 指向当前组件实例</p> <ul><li><p>方法一(箭头函数法):</p> <div class="language-Plain extra-class"><pre class="language-plain"><code>import React, { Component } from 'react'
export default class Test extends Component {
  // 按照es6类的语法,把函数写在这里,就是把函数定义在了当前类的原型上
  handle(){}

  render() {
    return (
        &lt;button
        {/* 注意: 此时的handle其实不是事件处理函数了, 而外层的箭头函数才是事件处理函数. 由于箭头函数没有this,所以这里的this是render的this. render中的this一定指向当前组件实例. 当用户点击按钮,箭头函数作为事件处理函数执行, 里面的代码this.handle()就会执行. 此时handle函数是被对象调用的.所以handle中的this就指向调用的对象,而调用的对象,不就是组件实例嘛 */}
          onClick={()=&gt;{this.handle()}}&gt;
         按钮
        &lt;/button&gt;
      &lt;/li&gt;
    )
  }
}
</code></pre></div></li> <li><p>方式二(使用 bind): 这种方式也是 React 官网示例中的处理方式</p> <div class="language-Plain extra-class"><pre class="language-plain"><code>import React, { Component } from 'react'
export default class Test extends Component {
  constructor(){
    //首先constructor中的this一定是当前组件实例.这行代码是利用原型上的handle函数,克隆了一个新的函数,这个新函数中的this固定指向了当前组件实例.  然后又将这个新的函数,赋值给当前组件实例的handle属性. 所以此时组件实例有一个handle属性,指向新的函数(新函数中的this又指向实例). 原型上有一个handle函数.
    // 由于类组件在加载时,一定先执行constructor,后执行render.所以在render函数中绑定click事件的handle是实例的handle. 而实例handle中的this的指向已经被绑定指向实例.
    // 但是这种处理方式逻辑比较复杂,并且实例和原型都有handle,性能也不是很好,所以不建议使用
	  this.handle = this.handle.bind(this)
  }

  // 按照es6类的语法,把函数写在这里,就是把函数定义在了当前类的原型上
  handle(){}

  render() {
    return (
        &lt;button
          onClick={this.handle}&gt;
         按钮
        &lt;/button&gt;
      &lt;/li&gt;
    )
  }
}
</code></pre></div></li> <li><p>方式三: 利用 es7 中实验性语法,直接添加给实例添加 handle</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">handle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//这是es7中的实验性语法,不过在create-create-app创建的项目中可以直接使用,因为项目中配置了babel</span>
  <span class="token comment">//这种写法是将handle直接添加到了组件的实例上面.可以理解为上面构造器中代码的简写形式</span>
  <span class="token comment">//所以这个handle里面的this,相当于使用的是construtor的this,当然可以指向组件实例.</span>
  <span class="token function-variable function">handle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 而且,我们已经定义状态也可以使用简写:</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">isEdit</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span> <span class="token comment">// 这就相当于在constructor中写this.state = {isEdit: false}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>button
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handle<span class="token punctuation">}</span><span class="token operator">&gt;</span>
         按钮
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p><strong>总结: 如果事件处理函数不需要访问组件实例,则应该添加到原型上. 如果需要访问组件实例,推荐使用 es7 实验性语法</strong></p> <h1 id="props"><a href="#props" class="header-anchor">#</a> props</h1> <blockquote><p>作用: 每个组件都是封闭独立的,props 可以让组件接收组件外部的数据</p></blockquote> <p><strong>应用场景:</strong></p> <p>假设有一个 List 组件,用于渲染无序列表,但是要渲染的数据是无法确定的.只有在使用 List 时才知道要渲染什么数据.这时就可以利用 props 将数据传递给 List,进而渲染出来</p> <h2 id="props-的基本使用"><a href="#props-的基本使用" class="header-anchor">#</a> props 的基本使用</h2> <blockquote><p>props 使用主要是两个步骤: 1. 给组件传递数据 2. 在组件内部接收数据</p></blockquote> <ul><li>传数据:</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">//在App组件的jsx结构中使用List组件</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 利用props方式给List组件传递数据, 属性名={值}就是传递数据的方法.属性名自定义</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token comment">/*第一个List渲染数字*/</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>List arr<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token comment">/*第二个List渲染字符*/</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>List arr<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>接收数据</p> <ul><li><p>函数组件接收</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 如果List组件是函数组件,则通过形参props接收数据.</span>
<span class="token keyword">function</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token comment">//props是对象 {arr: [...]} 对象中的属性,就是传递数据时,组件上的属性</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>类组件接收</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 如果List是类组件,则通过this.props接收数据</span>
<span class="token keyword">class</span> <span class="token class-name">List</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token comment">//props是对象 {arr: [...]} 对象中的属性,就是传递数据时,组件上的属性</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h2 id="props-的注意点"><a href="#props-的注意点" class="header-anchor">#</a> props 的注意点:</h2> <ol><li><p>props 传递数据是自上而下的(父--&gt;子), 而且必须逐级传递.</p> <p>如果有三个组件 App --&gt;Far--&gt;Son. 要将 App 的数据,传递给 Son. 只能先将数据从 App 传递给 Far,再从 Far 组件中传递数据给 Son</p></li> <li><p>props 可以传递任何类型的数据</p> <p><strong>除了传递一些普通的数据类型以外, 还可以传递虚拟 dom,组件类型和组件实例</strong></p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>demo组件<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token comment">// node属性传递的是虚拟dom, elementType传递的是Demo组件, element传递的是Demo组件实例</span>
<span class="token punctuation">;</span><span class="token operator">&lt;</span>Test node<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>虚拟dom<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">}</span> elementType<span class="token operator">=</span><span class="token punctuation">{</span>Demo<span class="token punctuation">}</span> element<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Demo <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token comment">// 渲染虚拟DOM</span>
      <span class="token punctuation">{</span>props<span class="token punctuation">.</span>node<span class="token punctuation">}</span>
      <span class="token comment">// 渲染组件实例</span>
      <span class="token punctuation">{</span>props<span class="token punctuation">.</span>element<span class="token punctuation">}</span>
      <span class="token comment">// 使用Demo组件</span>
      <span class="token operator">&lt;</span>props<span class="token punctuation">.</span>elementType <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><strong>props 数据是只读的,不要修改</strong>.并且 react 内部会检查我们是否修改了 props 数据,如果修改数据,会在控制台警告. 但是 react 内部检查是浅层对比.如果 props 中的数据是复杂数据类型,并且修改的是复杂数据类型中的值,则数据会被修改(不建议这样操作).</p></li> <li><p>在类组件的 constructor 中,无法直接通过 this.props 获取到数据.如需获取,必须在 constructor 的形参接收 props.并传递给 super()</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token comment">// 这样拿不到数据</span>
<span class="token punctuation">}</span>

<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token comment">// 这样就可以拿到数据了</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="props-校验"><a href="#props-校验" class="header-anchor">#</a> props 校验</h2> <blockquote><p>对传入组件的 props 数据进行类型检查</p></blockquote> <p>实现:</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在create-react-app创建的项目中,无需额外下载,直接引入就可以</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span>

<span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 组件需要配置props校验,就给组件添加静态属性propTypes</span>
Test<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 校验规则详询React官网</span>
  <span class="token literal-property property">属性</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>数据类型<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://zh-hans.reactjs.org/docs/typechecking-with-proptypes.html" target="_blank" rel="noopener noreferrer">详细校验规则参考官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="props-默认值"><a href="#props-默认值" class="header-anchor">#</a> props 默认值</h2> <blockquote><p>给传入组件的 props 数据配置默认值</p></blockquote> <p>实现:</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 组件需要配置props默认值,就给组件添加静态属性defaultProps</span>
<span class="token comment">// 当没有传递对应的属性时,默认值生效</span>
Test<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">属性</span><span class="token operator">:</span> 默认值<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="props-批量传递数据"><a href="#props-批量传递数据" class="header-anchor">#</a> props 批量传递数据</h2> <blockquote><p>如果要将对象中的所有数据,一个一个的传递给某个组件,可以使用 props 批量传递简化代码</p></blockquote> <p>例如:</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 假设有一个对象 obj =  {x:1,y:2,z:3}</span>
<span class="token operator">&lt;</span>Test x<span class="token operator">=</span><span class="token punctuation">{</span>obj<span class="token punctuation">.</span>x<span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span>obj<span class="token punctuation">.</span>y<span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span>obj<span class="token punctuation">.</span>z<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token comment">// 使用批量传递,可以达到和上面代码同样的效果,但是非常简洁</span>
<span class="token operator">&lt;</span>Test <span class="token punctuation">{</span><span class="token operator">...</span>obj<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><h2 id="props-的-children-属性"><a href="#props-的-children-属性" class="header-anchor">#</a> props 的 children 属性</h2> <p>写在组件子节点的内容,默认为 props 对象中 children 属性的值</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Test<span class="token operator">&gt;</span>测试<span class="token operator">&lt;</span><span class="token operator">/</span>Test<span class="token operator">&gt;</span>

<span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 展示`测试`两个字</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="todolist-案例"><a href="#todolist-案例" class="header-anchor">#</a> todoList 案例</h1> <p><img src="import/images/todos.gif" alt=""></p> <p>案例说明:</p> <ul><li><p>当前案例分为 5 个组件</p> <ul><li>Header 负责添加任务</li> <li>List 渲染无序列表</li> <li>Item 是 List 的子组件,封装了无序列表中的 li 标签</li> <li>Footer 负责底部的全选等</li> <li>App 根组件</li></ul></li> <li><p>实现功能</p> <ul><li>添加任务</li> <li>切换任务状态</li> <li>删除任务</li> <li>批量删除任务</li> <li>全选功能</li> <li>编辑任务名</li></ul></li></ul> <h1 id="操作表单"><a href="#操作表单" class="header-anchor">#</a> 操作表单</h1> <p>react 项目中操作表单有两种方式</p> <ol><li>受控组件: 表单元素通常自己维护 state，并根据用户输入进行更新.被 React 以这种方式控制取值的表单输入元素就叫做 <code>受控组件</code>(表单元素的值被 react 的 state 或 props 控制)</li> <li>非受控组件: 直接操作真实 DOM</li></ol> <h2 id="受控组件"><a href="#受控组件" class="header-anchor">#</a> 受控组件</h2> <ul><li><p>先以一个简单的文本框为例,学习受控组件方式</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">//将用户在文本框中输入的内容,存储到当前组件状态中</span>
<span class="token punctuation">}</span>

<span class="token comment">// change事件处理函数. 原生中给文本框注册的change事件,在文本框失去焦点时触发. 但是react中change事件,只要输入变化就会触发change事件</span>
<span class="token function-variable function">handle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 每一次用户输入,都会将用户输入的值,通过setState存储到state中</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">username</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form<span class="token operator">&gt;</span>
        <span class="token literal-property property">用户名</span><span class="token operator">:</span>
        <span class="token operator">&lt;</span>input
        type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>
        <span class="token punctuation">{</span><span class="token comment">/*
            文本框 value属性被组件state控制,此时用户在输入框中输入的内容,无法渲染到页面中的文本框里面.因为文本框的value的值被状态控制, 所以一定要定义change事件配合.在change事件处理函数中,将用户输入的内容赋值给state, state的值发生变化,文本框value的值也跟着变化,才会将用户输入渲染到文本框中
        */</span><span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>username<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handle<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>再来看下,其他的表单元素如何处理</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isAgree</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">'bj'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">handle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span>
        e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'checked'</span> <span class="token operator">?</span> e <span class="token operator">&gt;</span> target<span class="token punctuation">.</span>checked <span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value

      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">:</span> value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> isAgree<span class="token punctuation">,</span> city <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>form<span class="token operator">&gt;</span>
        <span class="token literal-property property">用户名</span><span class="token operator">:</span>
        <span class="token operator">&lt;</span>input
          type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token literal-property property">性别</span><span class="token operator">:</span>
        <span class="token operator">&lt;</span>input
          type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>
          name<span class="token operator">=</span><span class="token string">&quot;sex&quot;</span>
          value<span class="token operator">=</span><span class="token string">&quot;male&quot;</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token string">'sex'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
        男
        <span class="token operator">&lt;</span>input
          type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>
          name<span class="token operator">=</span><span class="token string">&quot;sex&quot;</span>
          value<span class="token operator">=</span><span class="token string">&quot;female&quot;</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token string">'sex'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
        女 <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token literal-property property">选择地区</span><span class="token operator">:</span>
        <span class="token operator">&lt;</span>select value<span class="token operator">=</span><span class="token punctuation">{</span>city<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token string">'city'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">&quot;bj&quot;</span><span class="token operator">&gt;</span>北京<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">&quot;sz&quot;</span><span class="token operator">&gt;</span>深圳<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">&quot;sh&quot;</span><span class="token operator">&gt;</span>上海<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token literal-property property">同意协议</span><span class="token operator">:</span>
        <span class="token operator">&lt;</span>input
          type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isAgree<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token string">'isAgree'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="非受控组件"><a href="#非受控组件" class="header-anchor">#</a> 非受控组件</h2> <blockquote><p>非受控组件的方式就是直接操作真实 dom,所以我们主要讨论,如何获取真实 dom</p></blockquote> <ul><li><p>事件处理函数中 e.target 可以获取到事件目标的真实 DOM</p></li> <li><p>在组件渲染成功之后,通过 DOM 原生获取方式拿到真实 DOM</p></li> <li><p>React 中提供的 refs 技术,拿到真实 DOM</p> <ul><li><p>方式一</p> <div class="language-Plain extra-class"><pre class="language-plain"><code>import React, { Component } from 'react'

// ref使用的第一种写法:
// 1. 创建ref对象
const refXXX = React.createRef()
// 2. 绑定要获取的真实dom所对应的JSX标签和ref对象
// 3. 直接通过ref对象.current获取到对应的真实dom
export default class App extends Component {
  render() {
    return (
      &lt;div&gt;
        {/* 2.绑定 */}
        &lt;input type=&quot;text&quot; ref={refXXX} /&gt;
        &lt;button
          onClick={() =&gt; {
            console.log(refXXX.current) //3. input的真实dom
          }}
        &gt;
          按钮
        &lt;/button&gt;
      &lt;/div&gt;
    )
  }
}
</code></pre></div></li> <li><p>方式二</p> <div class="language-Plain extra-class"><pre class="language-plain"><code>// ref使用的第二种写法:
// 1. 直接给需要获取真实dom所对应的JSX标签添加ref属性
// 2. ref属性的值是一个函数
// 3. 当真实dom创建好的时候,函数会调用,会将真实dom传递给函数的形参

import React, { Component } from 'react'
export default class App extends Component {
  render() {
    return (
      &lt;div&gt;
        &lt;input
          type=&quot;text&quot;
          ref={(node) =&gt; {
            this.yyy = node // 将真实dom存储到组件实例的yyy属性,.方便后续操作
          }}
        /&gt;
        &lt;button
          onClick={() =&gt; {
            console.log(this.yyy)
          }}
        &gt;
          按钮
        &lt;/button&gt;
      &lt;/div&gt;
    )
  }
}
</code></pre></div></li></ul></li></ul> <h1 id="组件通讯"><a href="#组件通讯" class="header-anchor">#</a> 组件通讯</h1> <p>实际开发中,组件和组件之间,经常需要互相传递数据. 这就是组件通讯</p> <p>react 组件通讯常用的三种方式:</p> <ul><li>props 主要用于父传子,只能一级一级传递</li> <li>context react 提供的方案,自上而下传递,允许跨级传递</li> <li>pubsub-js 第三方 js 库,不需要考虑组件关系,随意传递</li></ul> <p><img src="import/images/%E7%BB%84%E4%BB%B6%E9%80%9A%E8%AE%AF.png" alt="组件通讯"></p> <h2 id="利用-context-实现组件通讯"><a href="#利用-context-实现组件通讯" class="header-anchor">#</a> 利用 context 实现组件通讯</h2> <blockquote><p>这种方式主要适用于父级组件给子孙级组件传递数据.也是自上而下的,但是跟 props 的区别: 可以跨级传递数据</p></blockquote> <ul><li><p>传数据:</p> <ol><li><p>创建 context 对象</p> <p>const context = React.createContext('默认值')</p> <p><strong>注意: 默认值是在不写 Provider 的时候生效</strong></p></li> <li><p>从 context 中解构 Provider 组件.</p> <p>const {Provider} = context</p></li> <li><p>在要传递数据的组件中使用 Provider 包裹整个组件的 JSX. 并添加 value 属性,值就是要传递的数据</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>数据<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>App<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Far<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Far<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token comment">/*Far组件的子组件是Son组件,父组件是App组件*/</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
</code></pre></div></li></ol></li> <li><p>接收数据</p> <ul><li><p>方式一</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 原本的Son组件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Son<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 利用context接收App传递的数据的Son组件</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>Consumer<span class="token punctuation">}</span> <span class="token operator">=</span> context <span class="token comment">//注意:context要求和传递数据的context是同一个对象</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Consumer<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Son<span class="token punctuation">,</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Consumer<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>方式二</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// 给当前组件添加一个静态属性 contextType, 值就是context对象 注意:context要求和传递数据的context是同一个对象</span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> context
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//   this.context属性的值就是利用context技术传递过来的数据</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Son1<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h2 id="利用-pubsub-js-实现组件通讯"><a href="#利用-pubsub-js-实现组件通讯" class="header-anchor">#</a> 利用 pubsub-js 实现组件通讯</h2> <p><strong>注意</strong></p> <ul><li>pubsub-js 是一个独立的 js 库,而 props 和 context 是 react 技术.这一点很不一样</li> <li>props 和 context 在传递数据时,要求组件之间有嵌套关系.但是 pubsub-js 不需要</li> <li>pubsub-js 是基于发布订阅模式的 js 库, 传递数据的组件就是发布者, 接收数据的组件就是订阅者.一个组件既可以是发布者,也可以是订阅者.一个发布者,可以对应多个订阅者</li></ul> <p><strong>实现:</strong></p> <ol><li><p>安装</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">在项目根目录下</span><span class="token operator">:</span> npm i pubsub<span class="token operator">-</span>js
</code></pre></div></li> <li><p>哪里需要就在那里导入(发布和订阅的组件都需要引入)</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> PubSub <span class="token keyword">from</span> <span class="token string">'pubsub-js'</span> <span class="token comment">// 导入的PubSub是一个对象.提供了发布/订阅的功能</span>
</code></pre></div></li> <li><p>pubsubjs 提供的方法</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// PubSub.subscribe(话题, 回调) 用于接收数据</span>
<span class="token comment">// 第一个参数: 话题. 传递数据时的标记</span>
<span class="token comment">// 第二个参数: 用于接收数据的函数</span>
<span class="token comment">// 返回值 当前订阅的唯一标识符. 用于清除当前订阅. 一般都会在组件挂载时订阅</span>
<span class="token keyword">var</span> subId <span class="token operator">=</span> PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'car'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// msg 话题</span>
  <span class="token comment">// data 传递的数据</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 以异步的形式的发布一个话题</span>
<span class="token comment">// 'car'是话题, 所有订阅了'car'这个话题对应的回调函数都会被调用</span>
<span class="token comment">// 'hello world!' 具体要传递的数据</span>
PubSub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'car'</span><span class="token punctuation">,</span> <span class="token string">'hello world!'</span><span class="token punctuation">)</span>

<span class="token comment">// 取消指定的订阅 一般在组件卸载的时候,取消指定订阅</span>
PubSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span>subId<span class="token punctuation">)</span>

<span class="token comment">// 取消某个话题的所有订阅</span>
PubSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span>话题<span class="token punctuation">)</span>

<span class="token comment">// 取消所有订阅</span>
PubSub<span class="token punctuation">.</span><span class="token function">clearAllSubscriptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//为什么要取消订阅?</span>
<span class="token comment">//因为pubsub-js内部,管理了一个对象.每一次订阅的就是往对象中添加属性,值是数组,数组中存放了当前话题所对应的所有订阅的回调函数</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">car</span><span class="token operator">:</span> <span class="token punctuation">[</span>callback1<span class="token punctuation">,</span> callback2<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">//如果组件卸载了,但是组件的订阅还在,这就浪费了内存. 所以组件卸载的时候要清除订阅.</span>
</code></pre></div></li></ol> <h1 id="类组件的生命周期"><a href="#类组件的生命周期" class="header-anchor">#</a> 类组件的生命周期</h1> <ul><li><p>什么是组件的生命周期?</p> <p>是以拟人化的手法,描述了一个组件从使用到不使用的过程</p></li> <li><p>为什么要学习组件的生命周期?</p> <p>在实际开发中,我们需要在组件运行到某个指定阶段的时候执行一段代码. 比如: 当组件渲染到页面上的时候,需要设置一个定时器,在组件不被使用的时候,需要清除这个定时器. 所以我们就必须清楚,组件什么时候渲染完毕了,组件什么时候不被使用了</p></li> <li><p>注意:</p> <ol><li>函数组件没有生命周期钩子函数</li> <li>类组件中所有的生命周期钩子函数中的 this 都指向当前组件实例</li></ol></li></ul> <h2 id="类组件中常用的生命周期钩子"><a href="#类组件中常用的生命周期钩子" class="header-anchor">#</a> 类组件中常用的生命周期钩子</h2> <p><a href="https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/" target="_blank" rel="noopener noreferrer">生命周期图谱<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>在类组件的整个运行过程中,不同的阶段会有指定的回调函数被调用. 这些回调函数,被称为生命周期钩子函数. 学习组件的生命周期,其实主要就是学习有哪些生命周期钩子函数,这些生命周期钩子函数分别在什么阶段被调用</p></blockquote> <p><img src="import/images/lifecycle.png" alt=""></p> <p><strong>整个组件运行过程分为三个阶段</strong></p> <ul><li><p>挂载阶段(只执行一次)</p> <blockquote><p>当使用组件时,组件进入挂载阶段</p></blockquote> <ul><li>constructor 主要用于定义状态</li> <li>render 解析 jsx 生成虚拟 dom</li> <li>componentDidMount 表示组件第一次渲染完成(操作真实 DOM,发送异步请求)</li></ul></li> <li><p>更新阶段(执行多次)</p> <blockquote><p>父组件更新,或执行了 setState,forceUpdate 会让组件进入更新阶段</p></blockquote> <ul><li>render</li> <li>componentDidUpdate 表示组件重新渲染完成
<strong>注意: 最好不要在更新阶段的钩子函数里面调用 setState,会造成死循环</strong></li></ul></li> <li><p>卸载阶段(执行一次)</p> <blockquote><p>{ flag &amp;&amp; &lt;组件名 /&gt; } 当 flag 为 true 时,组件被使用,组件就挂载了,当 flag 为 false, 组件不被使用,组件就卸载了</p></blockquote> <ul><li>componentWillUnmount 表示组件即将卸载(清除操作)</li></ul></li></ul> <h2 id="react-类组件中其他不常用生命周期钩子-了解"><a href="#react-类组件中其他不常用生命周期钩子-了解" class="header-anchor">#</a> React 类组件中其他不常用生命周期钩子(了解)</h2> <ul><li><p>getDerivedStateFromProps(外界传入组件的数据, 组件内 state 的数据)</p> <blockquote><p>这个生命周期钩子,在组件的挂载阶段和更新阶段都执行.</p></blockquote> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 这个钩子是当前类的静态成员,所以要加static</span>
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// props 是组件外部传递进来的数据</span>
    <span class="token comment">// state 是当前组件的state的数据</span>
    <span class="token comment">// return的作用就是修改state的值</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">xxx</span><span class="token operator">:</span> props<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>xxx<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p>如果当前组件的 state 由外界传入到组件的数据决定时使用</p> <ul><li><p>getSnapshotBeforeUpdate(上一次外界传入的数据, 上一次 state 的数据)</p> <blockquote><p>这个钩子是在更新阶段执行, 是在 render 之后,componentDIdUpdate 之前.正好处于新旧真实 DOM 交替之间.</p></blockquote> <ul><li><p>应用场景: 当聊天的内容高度超过了 ul 的高度,后续的聊天内容看不到了(9 之后的聊天内容看不到了)</p> <p><img src="import/images/snapShot_before.png" alt=""></p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./SnapShotDemo.css'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timeid <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeid<span class="token punctuation">)</span>
      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'我和别人的的聊天内容: 哈哈'</span> <span class="token operator">+</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">messages</span><span class="token operator">:</span> arr<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> messages <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ul className<span class="token operator">=</span><span class="token string">&quot;box&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootNode <span class="token operator">=</span> node<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>messages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>使用 getSnapshotBeforeUpdate 解决上面的问题</p> <p><img src="import/images/snapShot_after.png" alt=""></p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./SnapShotDemo.css'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timeid <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeid<span class="token punctuation">)</span>
      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'我和别人的聊天内容: 哈哈'</span> <span class="token operator">+</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">messages</span><span class="token operator">:</span> arr<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//使用getSnapshotBeforeUpdate需要componentDidUpdate的配合</span>
  <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// return的结果,传递给了componentDidUpdate的第三个形参</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rootNode<span class="token punctuation">.</span>scrollHeight <span class="token comment">// 这里返回的是ul中添加新数据之前的内容高度</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">preProps<span class="token punctuation">,</span> preState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// preProps 是上一次外面传入的数据(当前案例未使用)</span>
    <span class="token comment">// preState 是上一次state的值(当前案例未使用)</span>
    <span class="token comment">// snapShot 是getSnapshotBeforeUpdate中的返回值, 也就是ul更新前的内容高度</span>
    <span class="token comment">// currentHeight 是ul更新后的内容高度</span>
    <span class="token keyword">const</span> currentHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rootNode<span class="token punctuation">.</span>scrollHeight
    <span class="token comment">// currentTop 是ul当前顶部滚动出去的距离</span>
    <span class="token keyword">const</span> currentTop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rootNode<span class="token punctuation">.</span>scrollTop
    <span class="token comment">// (currentHeight - snapshot) 得到的是ul内容更新前后的高度差</span>
    <span class="token comment">//  currentTop + (currentHeight - snapshot) 计算出来的是ul更新之后,顶部应该滚动出去的距离</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rootNode<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> currentTop <span class="token operator">+</span> <span class="token punctuation">(</span>currentHeight <span class="token operator">-</span> snapshot<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> messages <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ul className<span class="token operator">=</span><span class="token string">&quot;box&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootNode <span class="token operator">=</span> node<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>messages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p>shouldComponentUpdate(新的 props,新的 state)</p> <blockquote><p>shouldComponentUpdate 在更新阶段执行, 可以控制 render 函数是否调用.</p></blockquote> <p><strong>注意:</strong></p> <ol><li>在其他生命周期钩子函数中 this.state 和 this.props 都是最新的数据,但是在 shouldComponentUpdate 中 this.state 和 this.props 是上一次的数据,通过形参接收的是新的数据</li> <li>forceUpdate 触发的更新,不会执行 shouldComponentUpdate</li></ol> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello scu'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断nextState(新的)数据和this.state(旧的数据)如果相同则返回false,不更新组件. 如果不同则返回true,更新组件</span>
    <span class="token keyword">return</span> nextState<span class="token punctuation">.</span>msg <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'demo更新了'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        Demo
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span>
          demo<span class="token operator">-</span>按钮
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p>也就是说 shouldComponentUpdate 可以控制组件是否更新</p> <p>返回 true 则更新组件, 返回 false 则不更新组件</p></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/c190e1/"><div>
            函数进阶
            <!----></div></a> <span class="date">08-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/91cc90/"><div>
            react-router-dom
            <!----></div></a> <span class="date">08-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/9705e8/"><div>
            create-react-app
            <!----></div></a> <span class="date">08-19</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:16631085276@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/jlk-lebron" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>Lebron Jia  | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8d6e8c80.js" defer></script><script src="/assets/js/2.d1a10b95.js" defer></script><script src="/assets/js/32.9f59f731.js" defer></script>
  </body>
</html>
